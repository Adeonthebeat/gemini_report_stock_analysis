name: Financial Update

# âœ‹ ìˆ˜ë™ìœ¼ë¡œ ë²„íŠ¼ ëˆ„ë¥¼ ë•Œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤ (workflow_dispatch)
# ì›í•˜ì‹œë©´ scheduleì„ ì¶”ê°€í•´ì„œ ì£¼ë§ì—ë§Œ ëŒê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
on:
  workflow_dispatch:

jobs:
  financial-update:
    runs-on: ubuntu-latest

    steps:
    # 1. ì½”ë“œ ë‚´ë ¤ë°›ê¸°
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. íŒŒì´ì¬ 3.11 ì„¸íŒ…
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (ë©”ì¸ê³¼ ë™ì¼)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas yfinance google-genai sqlalchemy prefect python-dotenv tabulate markdown jinja2 psycopg2-binary

    # 4. ì¬ë¬´ì œí‘œ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ğŸš€
    - name: Run Financial Collector
      env:
        # DB ì—°ê²° ì •ë³´ í•„ìˆ˜!
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        # (í˜¹ì‹œ ì½”ë“œ ë‚´ë¶€ì—ì„œ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ë•Œ í•„ìš”í•  ìˆ˜ ìˆì–´ ë‹¤ë¥¸ í‚¤ë“¤ë„ ë„£ì–´ë‘¡ë‹ˆë‹¤)
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        EMAIL_USER: ${{ secrets.EMAIL_USER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}

      # ì•„ê¹Œ __name__ == "__main__" ì¶”ê°€í•œ íŒŒì¼ ì‹¤í–‰
      run: |
        python -m app.services.financial_collector
