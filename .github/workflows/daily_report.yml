name: Daily Stock Analysis Report

# ì–¸ì œ ì‹¤í–‰í• ê¹Œìš”? (íŠ¸ë¦¬ê±°)
on:
  schedule:
    # ğŸ•’ ì‹œê°„ ì„¤ì • (UTC ê¸°ì¤€)
    # í•œêµ­ ì‹œê°„ ì•„ì¹¨ 8ì‹œ = UTC ì „ë‚  ë°¤ 23:00
    # í™”~í† ìš”ì¼ ì‹¤í–‰ (ë¯¸êµ­ì¥ì€ ì›”~ê¸ˆ ì—´ë¦¬ì§€ë§Œ, í•œêµ­ ì‹œê°„ìœ¼ë¡œëŠ” í™”~í†  ìƒˆë²½ì— ë§ˆê°ë˜ë¯€ë¡œ)
    - cron: '0 23 * * 1-5'

  # âœ‹ ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (í…ŒìŠ¤íŠ¸ìš©)
  workflow_dispatch:

jobs:
  stock-analysis:
    runs-on: ubuntu-latest # ê¹ƒí—ˆë¸Œê°€ ë¹Œë ¤ì£¼ëŠ” ë¹ˆ ê¹¡í†µ ì»´í“¨í„° (ìš°ë¶„íˆ¬ ë¦¬ëˆ…ìŠ¤)

    steps:
    # 1. ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ì´ ì»´í“¨í„°ë¡œ ë‚´ë ¤ë°›ê¸°
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. íŒŒì´ì¬ ì„¤ì¹˜í•˜ê¸° (3.11 ë²„ì „)
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸°
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # [ìˆ˜ì •ë¨] psycopg2-binary ì¶”ê°€ (PostgreSQL ì ‘ì†ìš© í•„ìˆ˜!)
        pip install pandas yfinance google-genai sqlalchemy prefect python-dotenv tabulate markdown jinja2 psycopg2-binary

    # 4. (ì‚­ì œë¨) ë°ì´í„° í´ë” ë§Œë“¤ê¸° ë‹¨ê³„ëŠ” ì´ì œ í•„ìš” ì—†ìŠµë‹ˆë‹¤. (í´ë¼ìš°ë“œ DBë‹ˆê¹Œìš”!)

    # 5. ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ğŸš€
    - name: Run Main Script
      env:
        # ê¹ƒí—ˆë¸Œ ì„¤ì • í˜ì´ì§€(Secrets)ì— ì €ì¥í•´ë‘” ë¹„ë°€í‚¤ë“¤ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        EMAIL_USER: ${{ secrets.EMAIL_USER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}

        # [ìˆ˜ì •ë¨] ì—¬ê¸°ê°€ í•µì‹¬! Supabase ì£¼ì†Œë¥¼ ë¹„ë°€ ê¸ˆê³ ì—ì„œ êº¼ë‚´ì¤ë‹ˆë‹¤.
        DATABASE_URL: ${{ secrets.DATABASE_URL }}

      run: |
        python -m app.main